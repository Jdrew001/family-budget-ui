<ion-header [translucent]="true" class="mb-3">
  <ion-toolbar style="--border-style: none !important;">
    <h5 *ngIf="!selId" class="text-left strong">Create Transaction</h5>
    <h5 *ngIf="selId" class="text-left strong">Manage Transaction</h5>
    <ion-buttons (click)="closeTransaction()" class="mr-5" slot="end">
      <ion-icon class="text-md pt-3 strong" name="close-outline"></ion-icon>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" [formGroup]="formGroup" style="--padding-bottom: 10rem">
  <ion-grid>
    <ion-row>
      <ion-col>
        <div [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized" class="input-group m-0">
          <div class="group mb-0">
            <ion-label position="stacked">Account</ion-label>
            <swiper
              [allowTouchMove]="true"
              direction="horizontal"
              [slidesPerView]="2"
              [pagination]="true">
              <ng-template *ngFor="let item of accounts" swiperSlide>
                <app-card
                  [id]="item?.id!"
                  [active]="item?.active!"
                  margin="10px 5px 10px 5px" 
                  padding="5px"
                  (click)="onAccountSelect(item?.id!)">
                  <ion-grid>
                    <ion-row class="ion-justify-content-start">
                      <ion-col class="ion-align-self-center" size="2">
                        <ion-icon style="vertical-align: middle;" class="text-lg" [src]="'assets/icon/'+item?.icon+'.svg'" color="primary"></ion-icon>
                      </ion-col>
                      <ion-col></ion-col>
                      <ion-col size="8">
                        <p class="ellipse strong text-sm pb-0 mb-0">{{item?.name}}</p>
                        <p class="pt-0 m-0">{{item?.amount | currency:'USD':'symbol':'1.2-2'}}</p>
                      </ion-col>
                    </ion-row>
                    <ion-row>
                    </ion-row>
                  </ion-grid>
                </app-card>
              </ng-template>
            </swiper>
          </div>
        </div>

        <div *ngIf="!pageInitialized" class="input-group m-0">
          <div class="group mb-0">
            <ion-label position="stacked">Account</ion-label>
            <swiper
              [allowTouchMove]="true"
              direction="horizontal"
              [slidesPerView]="2"
              [pagination]="true">
              <ng-template *ngFor="let item of placeHolderAccounts" swiperSlide>
                <app-card
                  margin="10px 5px 10px 5px" 
                  padding="5px">
                  <ion-grid>
                    <ion-row class="ion-justify-content-start">
                      <ion-col class="ion-align-self-center" size="2">
                        <ion-skeleton-text [animated]="true" style="width: 100%"></ion-skeleton-text>
                      </ion-col>
                      <ion-col></ion-col>
                      <ion-col size="8">
                        <ion-skeleton-text [animated]="true" style="width: 80%"></ion-skeleton-text>
                        <ion-skeleton-text [animated]="true" style="width: 40%"></ion-skeleton-text>
                      </ion-col>
                    </ion-row>
                    <ion-row>
                    </ion-row>
                  </ion-grid>
                </app-card>
              </ng-template>
            </swiper>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <div class="input-group mt-5">
          <div class="group mb-0">
            <ion-label position="stacked">Description</ion-label>
            <ion-textarea [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized" formControlName="description" placeholder="Type something here"></ion-textarea>
            <ion-skeleton-text *ngIf="!pageInitialized" class="textarea-loader" [animated]="true"></ion-skeleton-text>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <div class="input-group mt-2">
          <div class="group mb-0">
            <ion-label position="stacked">Category</ion-label>
            <div [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized" (click)="chooseCategory()" class="input-lookalike">
              <p *ngIf="!selectedCategory?.value" class="placeholder">Select Category</p>
              <p *ngIf="selectedCategory?.value">{{ getSelCategory()?.name }}</p>
            </div>
            <ion-skeleton-text *ngIf="!pageInitialized" class="input-loader" [animated]="true"></ion-skeleton-text>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <div class="input-group mt-2">
          <div class="group mb-0">
            <ion-label position="stacked">Amount</ion-label>
            <ion-input [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized" currencyMask placeholder="Select Amount" formControlName="amount">
            </ion-input>
            <ion-skeleton-text *ngIf="!pageInitialized" class="input-loader" [animated]="true"></ion-skeleton-text>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row>
      <ion-col>
        <div class="input-group mt-2 mb-5">
          <div class="group mb-0">
            <ion-label position="stacked">Date</ion-label>
            <div [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized" (click)="chooseDate()" class="input-lookalike">
              <p *ngIf="!selectedDate?.value" class="placeholder">Select Date</p>
              <p *ngIf="selectedDate?.value">{{ selectedDate?.value | date:'MM/dd/yyyy' }}</p>
            </div>
            <ion-skeleton-text *ngIf="!pageInitialized" class="input-loader" [animated]="true"></ion-skeleton-text>
          </div>
        </div>
      </ion-col>
    </ion-row>

    <ion-row [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized">
      <ion-col>
        <div class="button-group mb-0 mt-5">
          <ion-button 
            class="shadow" 
            type="submit" 
            expand="block" 
            shape="round" 
            size="large" 
            [disabled]="!formGroup?.valid"
            (click)="onConfirm()">Confirm</ion-button>
        </div>
      </ion-col>
    </ion-row>

    <ion-row [@loadingContent]="pageInitialized ? 'enter' : 'void'" *ngIf="pageInitialized && !!selId?.value" class="ion-justify-content-center mt-4">
      <ion-col class="text-center">
        <ion-button (click)="onDelete()" size="default" color="danger" fill="clear" class="text-md m-0">
          <ion-icon slot="start" name="trash-outline"></ion-icon>
          Delete
        </ion-button>
      </ion-col>
    </ion-row>
  </ion-grid>

  <app-category-overlay #categoryOverlay
    [categoryRefData]="refData?.categories!"
    [showAccountOverlay]="showAccountOverlay"
    (onConfirm)="onSelectCategory($event)">
  </app-category-overlay>

  <app-date-overlay #dateOverlay
    [title]="'Transaction Date'"
    (onConfirm)="onSelectDate($event)"></app-date-overlay>

</ion-content>
